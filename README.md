# RustDesk安装使用说明

## 1. 公网服务器准备

在阿里云购买一个云服务器（服务器镜像中已经安装docker），创建服务器并进入。

## 2. docker启动服务

### 1. 执行代码

```
docker compose compose.yml up -d
```

### 2. 查看容器状态

```
docker ps -a --filter "name=^/(hbbs|hbbr)$"
```

> [!NOTE]
>
> 如果容器起来了，则进入下一步，否则排查问题。

### 3. 获取key

容器成功运行后，会在当前目录下生成一个`data`文件夹，进入`data`文件夹并`cat id_ed25519.pub`，终端会出现一串密钥，将其保存，后续配置客户端要用到。

## 3. 服务器端口配置

如果是云服务器（阿里云、腾讯云等），需在控制台的 “安全组” 中开放部分端口，否则公网无法访问，具体开放端口如下：

### hbbs服务所需端口

| 端口号 |   协议    |                             说明                             |
| :----: | :-------: | :----------------------------------------------------------: |
| 21115  |    TCP    |                      用于 NAT 类型测试                       |
| 21116  | TCP / UDP | 必须同时启用 TCP 和 UDP，用于 ID 注册、心跳服务（UDP）以及 TCP 打洞、连接服务（TCP） |
| 21118  |    TCP    |                 用于支持 Web 客户端（可选）                  |

### hbbr服务所需端口

| 端口号 | 协议 |            说明             |
| :----: | :--: | :-------------------------: |
| 21117  | TCP  |        用于中继服务         |
| 21119  | TCP  | 用于支持 Web 客户端（可选） |

> [!NOTE]
>
> 云上的云主机默认镜像是不会启用系统防火墙，如果开启 iptables, firewalld 或者 ufw，记得也要放行。

博主采用的是阿里云的轻量应用服务器，防火墙模板如下：

![防火墙模板](.\src\防火墙模板.PNG)

## 4. Rustdesk 客户端安装配置

### 1. 安装Rustdesk

在客户端和服务端都安装rustdesk-1.4.2-x86_64.exe执行文件，博主的客户端是window10系统，服务端是window7系统

### 2. 配置客户端

点击下图步骤1，会进入步骤2的设置

![客户端1](.\src\客户端1.PNG)

在设置中点击网络，然后点击ID/中继服务器，依次填入ID服务器、中继服务器、Key。其中ID服务器和中继服务器是阿里云服务器的公网IP地址，Key是上面保存的密钥。点击确认后会提示就绪。

![客户端2](.\src\客户端2.PNG)

### 3. 配置服务端

服务端只要填入ID服务器和Key即可，点击确认会提示就绪。

![客户端3](.\src\客户端3.PNG)

## 5. 连接测试

此时在客户端输入服务端的ID即可控制远程桌面。